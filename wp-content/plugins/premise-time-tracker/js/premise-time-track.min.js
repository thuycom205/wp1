<<<<<<< HEAD
/*! premise-time-track 2016-05-12 */
!function(a){a(document).ready(function(){b.init()});var b={months:["01","02","03","04","05","06","07","08","09","10","11","12"],fields:null,timestampStart:null,start:null,date:null,timestampStop:null,stop:null,timer:null,publish:null,startBtn:null,stopBtn:null,init:function(){this.startBtn=a(".ptt-start-btn")?a(".ptt-start-btn"):null,this.stopBtn=a(".ptt-stop-btn")?a(".ptt-stop-btn"):null,this.resetTimer(),this.bindEvents(),console.log("Premise Time Track initiated successfully")},bindEvents:function(){this.startBtn.click(this.startTimer),this.stopBtn.click(this.stopTimer),this.timeField.keyup(this.inputTime),this.timeField.focusout(this.checkTimeString),a(".ptt-new-timer").click(this.newTimer),0<a(".ptt-filter-by-date").length?this.filterByDate():!1,0<a(".ptt-filter-by-task").length?this.filterByTask():!1,this.bindDatepicker(),a(".ptt-delete-time-history").click(function(){a(this).parent().slideToggle().remove()}),a(".ptt-report .ptt-new-timesheet").click(function(){var b=a(".ptt-report-task:visible");b.each(function(){var b=[],c=a(this).find(".ptt-task-name").text().trim(),d=a(this).find(".ptt-fields-wrapper:visible");d.each(function(){var b={},d={};b.date=a(this).find(".ptt-cell-value-date").text().trim(),b.start=a(this).find(".ptt-cell-value-start").text().trim(),b.stop=a(this).find(".ptt-cell-value-stop").text().trim(),b.timer=a(this).find(".ptt-cell-value-timer").text().trim(),b.description=a(this).find(".ptt-cell-value-description").text().trim(),d[c]=b}),console.log(b)})})},filterByDate:function(){a(".ptt-filter-by-date").change(function(){if(""!==a(".ptt-filter-by-date.ptt-filter-from").val()&&""!==a(".ptt-filter-by-date.ptt-filter-to").val()){var c=new Date(a(".ptt-filter-by-date.ptt-filter-from").val()),d=new Date(a(".ptt-filter-by-date.ptt-filter-to").val());if(!(d>=c))return a(".ptt-filter-by-date.ptt-filter-to").val(""),alert('The "To" date must be greater than (or equal to) the "From" date.'),!1;a(".ptt-filterable-by-date .ptt-datepicker.hasDatepicker").each(function(){var b=a(this).val();if(""!==b){var e=new Date(b);e>=c&&d>=e?a(this).parents(".ptt-fields-wrapper").show("fast"):a(this).parents(".ptt-fields-wrapper").hide("fast")}})}else a(".ptt-fields-wrapper").show();return b.updateTimerTotal(),!1})},filterByTask:function(){a(".ptt-filter-by-task").keyup(function(){var c=a(this).val();return""!==c?a(".ptt-report-task").each(function(){var b=a(this).find(".ptt-task-name").text().toLowerCase();-1!==b.search(c)?(a(this).show("fast"),a(this).find(".ptt-fields-wrapper").show("fast")):(a(this).hide("fast"),a(this).find(".ptt-fields-wrapper").hide("fast"))}):a(".ptt-report-task").show("fast").removeClass("ptt-task-hidden"),b.updateTimerTotal(),!1})},updateTimerTotal:function(){var b=0;a(".ptt-filterable-by-date .ptt-timer-field").each(function(){if(a(this).parents(".ptt-fields-wrapper").is(":visible")&&""!==a(this).val()){console.log(a(this));var c=a(this).val();b+=+c}}),a(".ptt-filter-total").html(b)},startTimer:function(){var a=b.resetTimer();if(a.timestampStart.val()||""!==a.timestampStart.val()){var c=confirm("Are you sure you want to override the current time stamp?");if(!c)return!1}var d=new Date,e=a.months[d.getMonth()],f=d.getDate(),g=d.getFullYear(),h=d.getHours(),i="0"+d.getMinutes(),j=("0"+d.getSeconds(),h+":"+i.substr(-2)),k=e+"/"+f+"/"+g;return a.timestampStart.val(d),a.start.val(j),a.date.val(k),a.stop.val(""),a.timestampStop.val(""),a.saveTimer(),!1},stopTimer:function(){var a=b.resetTimer();if(""==a.start.val())return alert("You must start the timer first or fill in the 'From' field."),!1;var c=new Date,d=c.getHours(),e="0"+c.getMinutes(),f=("0"+c.getSeconds(),d+":"+e.substr(-2)),g=a.start.val();return a.timestampStop.val(c),a.stop.val(f),a.timer.val(a.recordTime(g,f)),a.newTimer(!0),!1},recordTime:function(a,c){var d=b;if(c=c||"00:00",""===c)return d.timer.val(""),!1;if(c=c.split(":"),c[0]="00"==c[0]?24:c[0],a=a||"00:00",""===a)return d.timer.val(""),!1;if(a=a.split(":"),c[0]>=a[0]){var e=60*(c[0]-a[0]),f=c[1]-a[1],g=+e+ +f;if(0>g)return"";var h=(Math.ceil(+g/60*4)/4).toFixed(2);return h}return""},validateTime:function(b){b=b||"";var c=b,d=c.length,e=new RegExp(/[^0-9:]/g);if(c=c.replace(e,""),2==d&&2==c.length)return 24>+c?c+":":"00:";if(5==d&&5==c.length){var f=c.substr(-2);return 60>+f?c:c.substr(0,3)+"00"}return d>5?(a(el).val(c.substr(0,5)),!1):c},inputTime:function(){var c=b,d=a(this).val(),e=a(this).is(".ptt-start")?!1:!0;if(a(this).val(b.validateTime(d)),e){var f=a(this).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==f){var g=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");g.val(c.recordTime(f,d))}}else{var h=a(this).parents(".ptt-fields-wrapper").find(".ptt-stop").val();if(""!==h){var g=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");g.val(c.recordTime(d,h))}}},checkTimeString:function(){if(str=a(this).val(),5>=str.length)if(3==str.length)a(this).val(str+"00");else if(4==str.length){{var c=str.substr(0,3);"0"+str.substr(-2)}a(this).val(c+mins),console.log(a(this).val())}else{var d=a(this).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==d){var e=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");e.val(b.recordTime(d,str))}}return!1},newTimer:function(c){c=c||!1;var d=b.resetTimer(this),e=d.countUp();a(".ptt-time-history").append('<div class="ptt-fields-wrapper ptt-time-history-'+e+'"></div>');var f=d.fields.clone();a(".ptt-time-history-"+e).append(f);var g={action:"ptt_new_timer",count:d.historyCount};return a.post(ajaxurl,g,function(b){a(".ptt-timer-fields").html(b)}).done(function(){d.resetTimer(this),d.timeField.keyup(d.inputTime),d.bindDatepicker(),d.updateTimerTotal(),c&&d.saveTimer()}),console.log(d.timeField),!1},saveTimer:function(){a("#publish").click()},resetTimer:function(){return self=b,self.historyCount=a(".ptt-time-history > div").length,self.fields=a(".ptt-timer").find(".ptt-timer-fields > .premise-field"),self.timestampStart=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_start"),self.start=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-start"),self.date=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-date"),self.timestampStop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_stop"),self.stop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-stop"),self.timer=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timer"),self.timeField=a(".ptt-time-field"),self},countUp:function(){return self.historyCount+1},bindDatepicker:function(){"object"==typeof a.datepicker&&a(".ptt-datepicker").datepicker({inline:!0})}}}(jQuery);
=======
/*! premise-time-track 2017-02-13 */
!function(a){function b(){function b(){j.html(m)}function c(a){return j.html(a),d(),l&&p(),!1}function d(){var b=0;a(".pwptt-time-card-time").each(function(){b=parseFloat(a(this).text())+parseFloat(b),k.html(b)})}var e,f=a("#pwptt-loop-wrapper"),g=a(".pwptt-search"),h=a("#pwptt-quick-change"),i=a("#pwptt-author"),j=a("#pwptt-body"),k=a(".pwptt-total-hours"),l=a(".iframe").length,m='<p class="pwptt-loading"><i class="fa fa-spin fa-spinner"></i></p>',n=pwptt_localized.wpajaxurl,o=function(){l&&(window.addEventListener("message",q,!1),p()),f.length?r():!1},p=function(){a(".pwptt-iframe-edit a").on("click",function(b){b.preventDefault();var c=a(this).attr("href");return e.postMessage(c,"*"),!1})},q=function(a){console.log(a.origin),"edit"===a.data&&(e=a.source,window.removeEventListener("message",q))},r=function(){g.length&&(g.change(s),g.keyup(function(a){13===a.keyCode?s:!1})),h.length&&h.change(function(d){d.preventDefault(),b(),g.val("");var e={action:"ptt_search_timers",quick_change:a(this).val(),taxonomy:g.attr("data-tax"),slug:g.attr("data-slug")};return l&&(e.iframe=!0),a.post(n,e,c),!1}),i.length&&i.change(function(d){d.preventDefault(),b(),g.val("");var e={action:"ptt_search_timers",author:a(this).val(),taxonomy:g.attr("data-tax"),slug:g.attr("data-slug")};return l&&(e.iframe=!0),a.post(n,e,c),!1})},s=function(){var d=a(this),e=d.val()?d.val():"",f=d.attr("data-tax"),g=d.attr("data-slug"),h=new RegExp("^(([0-9]{1,2})/([0-9]{1,2})/([0-9]{2,4})) ?(-) ?(([0-9]{1,2})/([0-9]{1,2})/([0-9]{2,4}))$","g"),i=e.match(h);if(i){b();var j=i[0].split("-"),k={action:"ptt_search_timers",taxonomy:f,slug:g,date_range:{from:j[0],to:j[1]}};l&&(k.iframe=!0),a.post(n,k,c)}return!1};o()}a(document).ready(function(){b()})}(jQuery);
>>>>>>> v2-0-0
